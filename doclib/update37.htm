<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="ja">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta http-equiv="Content-Language" content="ja">
	<meta http-equiv="Content-Style-Type" content="text/css">
	<meta http-equiv="Content-Script-Type" content="text/javascript">
	<meta name="author" content="OpenHSP3 Project">
	<meta name="keywords" content="HSP,HSP3,Hot Soup Processor,更新情報,アップデート">
	<meta name="description" content="HSPの更新情報を掲載">
	<link href="../main.css" rel="stylesheet" type="text/css" media="all">
	<title>HSP3.7 新機能ハイライト</title>
</head>
<body>
	<div id="CONTAINER">
		<!-- ヘッダー -->
		<p id="COPY">HSP : Hot Soup Processor ver3.7 / onion software 1997-2025(c)</p>
		<img src="hsp3ttl.jpg" alt="title" width="640" height="200">
		<h1>HSP3.7 新機能ハイライト</h1>

		<!-- 目次 -->
		<ol>
			<li><a href="#HSP3UPDATE">HSP3.7アップデート概要</a></li>
			<li><a href="#USE">プリプロセッサ命令、「#use」について</a></li>
			<li><a href="#HSP3C">コンパクト(hsp3c)版ランタイムについて</a></li>
			<li><a href="#HGIMG4TOOL">HGIMG4ツールの更新について</a></li>
			<li><a href="#HSP3DISH_DRAW">HSP3Dishのboxf描画命令の修正について</a></li>
			<li><a href="#PACKFILE_DPM">DPM2形式による複数ファイルのパックについて</a></li>
			<li><a href="#HSP3DISH_HELPER">HSP3Dishサポートツールについて</a></li>
			<li><a href="#DOTFW">珠音ドットフレームワークについて</a></li>
			<li><a href="#OGGFILE">HSP3Dishのサウンド再生について</a></li>
			<li><a href="#CELLOAD">celload命令のID割り当てについて</a></li>
			<li><a href="#HSPINET">hspinetプラグインの更新について</a></li>
		</ol>
		
		<!-- 本文 -->
	<h2 id="HSP3UPDATE">HSP3.7のアップデート概要</h2>
		<p>
		HSP3.7は、特に変更を意識することなく、HSP3.6と同様にお使い頂けます。
		HSP3.7で変更された項目の概要は、以下の通りです。詳細な修正事項は<a href="history.txt">「history.txt」</a>を参照してください。
		</p>

		<dl>

			<dt>
			変数名の管理とデバッグ機能の拡充
			</dt><br>
			<dd>
			<p>
			HSP3.7では、大規模のスクリプトを安全に記述するための変数管理とデバッグを行うための仕組みが新たに導入されています。<br>
			通常、スクリプト中で定義された変数は、それ以降は自由に内容の読み出し・書き込みが可能になります。
			スクリプトの規模が大きくなり、扱う変数が膨大になった場合、誤って既に使用されている変数の内容を上書きしてしまったり、変数名のタイプミスにより予期しない動作となる可能性があります。<br>
			このような問題を避けるために、初期化せずに変数を参照した際にエラーが表示されるオプションと、明示的に変数初期化を行うための#var,#varint,#varstr,#vardouble等のプリプロセッサ命令が用意されました。
			変数型を固定したり、代入を禁止することで意図しない変数の初期化や値の上書きを防止します。また、変数に関わる問題を発見するためのデバッグ機能も拡充されています。<br>
			詳しくは、<a href="hspprog.htm#VAR_EX">プログラミング・マニュアル「変数の初期化と保護」</a>をご覧ください。<br>
			さらに、特定の変数に値が代入されたタイミングでデバッグログに内容を記録する変数デバッグ機能が追加されています。
			詳しくは、<a href="hspprog.htm#DEBUG_VARS">プログラミング・マニュアル「変数デバッグメッセージ」</a>をご覧ください。
			</p>
			</dd>

			<dt>
			スクリプトエディタのソース解析機能
			</dt><br>
			<dd>
			<p>
			HSP3.7では、スクリプトエディタ上で編集中のソース解析を行い、関連する変数やラベル、ユーザー定義命令・関数などに素早くアクセスすることが可能になりました。<br>
			<a href="hspprog.htm#GOTODEFINE">「キーワード定義への移動機能」</a>、
			<a href="hspprog.htm#ALLREFERENCE">「すべての参照を検索機能」</a>、
			<a href="hspprog.htm#LABELLIST">「ラベル一覧機能」</a>を利用することで、
			大規模なスクリプトファイルであっても適切に流れを掴むことができます。これは、サンプルや他の人が作ったスクリプトの動作を確認する際にも強力な支援となります。
			</p>
			</dd>

			<dt>
			アップデート機能の更新
			</dt><br>
			<dd>
			<p>
			<img src="hsp3update/hspupd_menu.png" width="480"><br><br>
			HSP3.7では、HSP3アップデーター (HSP3Update)を同梱しています。これにより、必要な機能や拡張プラグイン、素材やサンプルなどを選択してインストールすることが可能です。
			ユーザーが公開するアップデートなども含めて幅広くインストールパッケージを管理することのできる手軽な機能です。<br>
			HSP3.7β8以降では、いくつかの機能をパッケージに分割し、最小の開発セットから必要な機能を拡張することができるようになっています。
			</p><pre>
				hsp37ベースパッケージ     Windows向けの基本的な開発機能
				hsp37mpパッケージ         Windows上でマルチプラットフォーム開発を行う機能
				hsp37hgimg3パッケージ     Windows上でHGIMG3(レガシーシステム)開発を行う機能
				hsp37hgimg4dxパッケージ   Windows上でHGIMG4(DirectX更新版)開発を行う機能
			</pre><p>
			HSP3フルセット版は、ベースパッケージ及びマルチプラットフォーム開発、HGIMG3を内包したものになっています。<br>
			
			HSP3アップデーター (HSP3Update)の使用方法については、<a href="hsp3update.html">HSP3アップデーター (HSP3Update) マニュアル</a>をご覧ください。
			</p>
			</dd>

			<dt>
			新規モジュール/プラグインの追加
			</dt><br>
			<dd>
			<p>
			新しい機能を拡張するための各種モジュールが拡充されています。
			バーチャルパッドをサポートする<a href="plugin.htm#mod_vpad">mod_vpadモジュール</a>、
			多彩な音声合成をサポートする<a href="hspvoicevox.html">hspvoicevoxプラグイン</a>、
			Windowsのボリューム設定、音量レベルメーターを取得する<a href="plugin.htm#mod_mmaudio">mod_mmaudioモジュール</a>、
			簡易的な麻雀の処理をまとめたmod_mahjongモジュール、
			珠音ちゃん・プロ生ちゃんSD上半身コラボ素材を表示するためのmod_tamakeisdモジュール、
			などなど多くの新機能を利用できます。<br>
			また、それに合わせてHSP3.7の新機能を使用したサンプルが多数追加されています。(sample/hsp37フォルダほか)<br>
			sample/hspinetフォルダには、hspinetプラグインを活用してGoogle Gemini APIにアクセスするサンプルが追加されています。AIを利用するための、プロンプトの送受信を行うことが可能です。
			</p>
			</dd>

			<dt>
			ゲーム向け支援機能「珠音（たまね）ドットフレームワーク」を搭載
			</dt><br>
			<dd>
			<p>
			ゲームの作成をサポートする<a href="dotfw.html">「珠音（たまね）ドットフレームワーク」</a>を新たに搭載しています。<br>
			HSPTV!が提供するドット絵素材とHSP3Dish上で使用できる強力なライブラリにより、手軽にレトロスタイルの自作ゲームを作り始めることが可能です。 作成したゲームは、WindowsだけでなくWebやラズパイ、Linux、android、iOSなどで発表することが可能です。<br>
			短いコードだけでシューティングやジャンプアクションの処理を実現できるほか、<a href="tamamap.html">「マップエディタ Tamamap」</a>により広い世界のマップを構築することが可能です。<br>
			HSP3Dishが持つ基本的な<a href="sprite.html">「標準スプライト機能」</a>も大幅にパワーアップしており、2Dゲーム、疑似3Dゲームなどのサンプルを多数追加しています。<br><br>
			<img src="hsp3dish/fwmap4.jpg" width="480"><br><br>
			<img src="hsp3dish/sprite3d.png" width="480"><br><br>
			</p>
			</dd>

			<dt>
			DPMファイル及びファイル暗号化埋め込み機能の更新
			</dt><br>
			<dd>
			<p>
			HSP3.6までのファイル埋め込み機能(PACKFILE)ではファイル名の長さに制約がありフォルダの階層構造をサポートしていませんでした。<br>
			HSP3.7では、ファイル埋め込み機能を更新してフォルダ構造や暗号化の刷新、HGIMG4への対応などを行っています。
			また、HSP3Dishでの使用や対応ツールの強化などにより、今までよりも便利にご使用いただけます。
			詳しくは、<a href="hspprog.htm#PACKFILE">プログラミング・マニュアル「ファイルのパックと暗号化」</a>をご覧ください。<br>
			</p>
			</dd>

			<dt>
			html5/hsp3js版の修正
			</dt><br>
			<dd>
			<p>
			HSP3DishやHGIMG4対応スクリプトをWebブラウザ版で実行することができる、hsp3js版の機能を拡充しています。HSP3Dishの安定した動作を実現し、HGIMG4に対応した高度な3D表示をサポートしています。<br>
			表示サイズの調整に対応したほか、加速度、ジャイロセンサー値の取得が可能になっています。また、HGIMG4のオフスクリーンバッファ、ポストエフェクトなどもWebGLを通して高速に実行されます。
			</p>
			</dd>

			<dt>
			HSP3Dish android版のビルド機能修正
			</dt><br>
			<dd>
			<p>
			<a href="hsp3dish_prog.htm">HSP3Dish</a>のandroid向けビルド機能を大きく変更しています。<br>
			HSP3.6までのantツールを使用したビルドから、Gradleを使用した最新のビルド方法に変更されています。
			これにより、Google Playストアでの配信に必要となるaab形式のファイルをビルドすることが可能になります。<br>
			今まで通りデバイスへの変換をサポートするHSP3Dish Helperツールをご利用頂けますが、既存のプロジェクトとは互換性がないため、新規に作成する必要があるのでご注意ください。<br>
			また、新しいHSP3Dish Helperでは、androidエミュレータの作成・実行、リリースバージョンの管理、ビルド後の自動実行などの機能が追加されています。
			</p>
			</dd>

			<dt>
			HSP3不具合の修正
			</dt><br>
			<dd>
			<p>
			HSP3インタプリアコア部分で、HSP3.6リリース後に報告されたいくつかの不具合が修正されています。<br>
			モジュール型配列変数の代入時の不具合、#constで定義されたdouble型実数値の有効桁数が少なかった不具合などが修正されています。
			</p>
			</dd>

			<dt>
			レガシー機能の廃止
			</dt><br>
			<dd>
			<p>
			HSP3のランタイムやツールで古くなったもののいくつかを同梱終了しています。<br>
			「コンパクト(hsp3c)版ランタイム」及び「Peasエディタ」はHSP3.6までのサポートとなります。<br>
			また、HGIMG3ランタイムは同梱を終了し、別パッケージでの配布となっています。
			</p>
			</dd>

		</dl>


	<h2 id="USE">プリプロセッサ命令、「#use」について</h2>
		<p>
		HSP3.7では従来の「#include」に代わり、「#use」というプリプロセッサ命令を利用できます。<br>
		#use命令は、「#include」と同様に別なスクリプトファイルを結合しますが、ファイルを簡易指定できるようになっています。たとえば、「#include "hsp3dish.as"」は「#use hsp3dish」と記述することができます。(どちらも機能的には、まったく同じ結果になります)
		<br>
		#use命令は「"hsp3dish.as"」のような文字列ではなく、「hsp3dish」のように拡張子を除いた名称だけを指定することができます。(パラメーターで指定される名前は、変数と同様のルールで記述された文字である必要があります。)<br>
		パラメーターで指定された名前に「.as」という拡張子を付加したものをスクリプトファイルとして結合します。
「.as」という拡張子を持つファイルが存在しない場合は、「.hsp」という拡張子が検索されます。>
どちらの拡張子を持つファイルも存在しなかった場合は、エラーとなります。
		<br>
		また、#use命令では「,」記号で区切ることで、複数の名前を連続で記述することが可能です。
		</p>
		<pre>
		#use strict,hsp3dish,mod_appconfig
		</pre>
		<p>
		こういった形で、従来よりも簡潔にファイルを呼び出して指定することができます。
		</p>


	<h2 id="HSP3C">コンパクト(hsp3c)版ランタイムについて</h2>
		<p>
		HSP3.6までのコンパクト版ランタイム(hsp3c)は、HSP3.7から運用を廃止しています。<br>
		コンパクト版ランタイムは、Windows 98以降の動作をサポートするために古いコンパイラを使用していましたが、
		ファイルサイズの僅かな削減以外のメリットが少なく、現行のOS上で実行の効率が悪いことから同梱を終了ることとしました。<br>
		hsp3cを使用していたユーザーは、引き続き標準のHSP3ランタイムをご使用頂くようお願い致します。
		</p>


	<h2 id="HGIMG4TOOL">HGIMG4ツールの更新について</h2>
		<p>
		HGIMG4について以下の修正を行っています。
		</p>
		<dl>

			<dt>
			HGIMG4ツール(gpbconv)の機能修正
			</dt><br>
			<dd>
			<p>
			<a href="hgimg4.html">HGIMG4</a>の3Dモデル変換に使用するHGIMG4ツール(gpbconv)の機能修正を行っています。<br>
			変換された3Dデータのプレビュー機能が実装されているほか、
			3Dモデル変換時のマテリアル名に日本語など英文字以外を含む場合、正しく認識されないことがあるため、マテリアル名修正に関するオプション指定を追加しました。
			また、モデルファイルとは別にアニメーションデータをFBXファイルで用意したものを結合するためのオプションが追加されています。
			</p>
			</dd>

			<dt>
			getnearobj、getcoli命令の修正
			</dt><br>
			<dd>
			<p>
			getcoli命令では、検索されるIDの範囲を設定できるようになっています。
			また、最も近くにあるオブジェクトを検索するgetnearobj命令を追加しています。
			<br>詳しくは、ヘルプ及び<a href="hgimg4.html">HGIMG4マニュアル</a>をご覧ください。<br>
			</p>
			</dd>

			<dt>
			gppraytest、gppsweeptest命令の修正
			</dt><br>
			<dd>
			<p>
			物理設定されたオブジェクト移動後の衝突テストを行うgppsweeptest命令が追加されています。
			また、gppraytest命令にコリジョングループによる判定を行うオプションが追加されています。
			<br>詳しくは、ヘルプ及び<a href="hgimg4.html">HGIMG4マニュアル</a>をご覧ください。<br>
			</p>
			</dd>

			<dt>
			angle最新版の提供
			</dt><br>
			<dd>
			<p>
			HGIMG4のDirectX版(hsp3gpdx)で、最新のangleライブラリを使用した
			バージョンを別パッケージとして提供しています。
			これにより、互換性をより高めたDirectX版を選択することが可能になります。
			</p>
			</dd>

		</dl>


	<h2 id="HSP3DISH_DRAW">HSP3Dishのboxf描画命令の修正について</h2>
		<p>
		HSP3.7β2からWindows版のHSP3Dishでboxf命令の塗りつぶし範囲が標準ランタイムと異なる不具合を修正しています。<br>
		それまで右と下の1ドットがいままで描画されていなかったものを正常な動作に修正しています。
		ほとんどの場合問題は出ないものと考えていますが、それまでの動作を基準に作成していたスクリプトで描画の結果が異なる場合がありますのでご了承ください。
		システムリクエストにより、従来の描画に戻すことも可能です。その場合は、以下のようにsetreq命令を記述してください。
		</p>
		<pre>
			setreq SYSREQ_OLDBOXF,1		; HSP3.6のboxf動作を維持する
		</pre>
		<p>
		</p>


	<h2 id="PACKFILE_DPM">DPM2形式による複数ファイルのパックについて</h2>
		<p>
		HSP3.7からパックして埋め込まれるデータの形式がDPM2という新しいものになりました。
		これにより、いままでよりも制約の少ない自由なファイルのパック、暗号化を利用することができます。
		HSP3.7では、複数の.dpmファイルを同時に使用することができるほか、ファイル名の長さやサイズの制限が緩和されています。
		<br>
		<b>※HSP3.7β3版までとHSP3.7β4以降ではファイルのパックについての仕様が変更されています。#pack及び、#epack命令はHSP3.6と互換性のある動作になり、フォルダ構造やワイルドカードを試用した追加は、#packdir、#epackdir命令として新規に追加されました。<br>
		HSP3.7β3版までの仕様で記述されている方には、申し訳ありませんが#packdir、#epackdir命令を使用する形に修正をお願い致します。</b>
		<br>
		詳しくは、<a href="hspprog.htm#PACKFILE">「ファイルのパックと暗号化」</a>の項目を参照してください。
		</p>


	<h2 id="HSP3DISH_HELPER">HSP3Dishサポートツールにいて</h2>
		<p>
		HSP3Dishでのプロジェクト設定やdpmファイルなどの作成をサポートするツールが新規で追加されています。
		以下のサポートツールは、HSP3Dish HelperやHSPスクリプトエディタから起動することができます。
		</p>
		<pre>
		ツール名                         起動方法
		--------------------------------------------------------------------------
		Dish P Helper                    HSP3Dish Helper Androidタブから
		#packoptリスト作成ツール         スクリプトエディタ「ツール」メニューから
		#packリスト作成ツール            スクリプトエディタ「ツール」メニューから
		Android/iOSアイコン作成ツール    HSP3Dish Helper Android/iOSタブから
		dotfwマップエディタ              スクリプトエディタ「ツール」メニューから
		</pre>
		<p>
		</p>


	<h2 id="DOTFW">珠音ドットフレームワークにいて</h2>
		<p>
		「珠音（たまね）ドットフレームワーク」は、ドット絵のHSP3オフィシャル素材とHSP3Dish上で使用できるライブラリのセットです。
		ゲームに特化したシンプルな命令セットとオールインワンの素材パッケージで手軽にレトロスタイルの自作ゲームを作り始めることが可能です。 作成したゲームは、WindowsだけでなくWebやラズパイ、Linux、android、iOSなどで発表することが可能です。
		サンプルスクリプトが「sample/dotfw」フォルダに用意されていますのでお試しください。
		<br>
		詳しくは、<a href="dotfw.html">珠音ドットフレームワークマニュアル</a>を参照してください。
		</p>


	<h2 id="OGGFILE">HSP3Dishのサウンド再生について</h2>
		<p>
		Windows版のHSP3Dish及びHGIMG4のサウンド再生について更新を行っています。
		内蔵のサウンドシステムを切り離して外部のサウンド関連プラグインを利用する機能が追加されています。
		これにより、hspoggプラグインを利用してoggファイルの再生を行うことが可能になります。
		また、HGIMG3及びhspoggプラグインでは、oggファイル再生をオンメモリで行うよう修正されています。
		<br>
		暗号化されたdpmファイルや埋め込みデータを含めてHSP3が扱うファイルシステムからサウンドデータの読み込みが可能になりました。従来までのストリーミングによる再生を行う方法も選択できますので、状況に応じてお使い頂けます。
		</p>
		<pre>
		ファイル種別                     再生方法
		--------------------------------------------------------------------------
		wave形式(拡張子.wav)             オンメモリ再生(埋め込みデータ対応)
		ogg vorbis形式(拡張子.ogg)       オンメモリ再生(埋め込みデータ対応)
		ogg vorbis形式(拡張子.s)         ストリーミング再生(埋め込みデータ非対応)
		</pre>
		<p>
		詳しくは、<a href="hspogg.txt">hspoggマニュアル</a>を参照してください。
		</p>


	<h2 id="CELLOAD">celload命令のID割り当てについて</h2>
		<p>
		HSP3.7β4から、celload命令で読み込みウインドウIDの指定を省略(またはマイナス値)して自動的にIDを割り当てる際の動作が修正されています。<br>
		ceload命令のウィンドウIDパラメーターが省略された場合には、すでに読み込まれている画像ファイルと同一のファイル名を指定した場合、 読み込まれているウインドウIDが再利用されます。
		この動作は、標準のHSP3ランタイム、HSP3Dishランタイムを含むすべてのプラットフォームで適用されます。
		<br>
		これにより、重複した画像を読み込もうとした場合に、リソースを共有してメモリを節約することができます。
		外部のモジュール内で画像を使用する場合や、ソースを再利用した場合にリソースの重複を防ぎます。
		(既存のバージョンでは、重複した画像が読み込まれても常に新しいIDが割り当てられています。)
		<br>
		この変更により、既存のスクリプトで重複した画像ファイルを複数の異なるウインドウIDに読み込んでいる場合などで、IDの割り当てに不一致が起こる可能性があります。
		ウインドウIDの再利用をしたくない場合は、「celload "a.png",celid_auto」のようにパラメーターにcelid_auto(または-1)を指定してください。
		<br>
		詳しくは、<a href="hspprog.htm#CEL_FUNCTION">CEL関連命令について</a>を参照してください。
		</p>


	<h2 id="HSPINET">hspinetプラグインの更新について</h2>
		<p>
		Windowsでネットワークアクセスに関する拡張機能を提供するhspinetプラグインが更新されています。
		<br>
		SHA256ハッシュ値を取得する命令が追加されているほか、
		JSONオブジェクトの解析で実数や配列を扱うための命令が新たにサポートされています。
		これにより、各種WebAPIへのアクセスと、データ取得の応用範囲をさらに広げることができます。
		<br>
		新規のサンプルスクリプトとしてGoogle GeminiのAPIを使用して、AIプロンプトの送受信を行う
		「gemini.hsp」が同梱されています。( sample/hspinet フォルダ )
		<br>
		最新のネットワーク機能をぜひお試しください。
		</p>


		<!-- フッター -->
		<ul id="FOOTER">
			<li><a href="#CONTAINER">このページの1番上に戻る</a></li>
			<li><a href="../index.htm">ドキュメントの一覧に戻る</a></li>
			<li><a href="https://hsp.tv/">Go to HSPTV page</a></li>
		</ul>
		<a href="https://www.onionsoft.net/hsp/">
			<img src="img/onibtn.gif" width="147" height="50" alt="ONION software" id="ONIBTN">
		</a>
	</div><!-- container -->
</body>
</html>
