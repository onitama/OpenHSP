<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta http-equiv="Content-Language" content="en">
	<meta http-equiv="Content-Style-Type" content="text/css">
	<meta http-equiv="Content-Script-Type" content="text/javascript">
	<meta name="author" content="OpenHSP3 Project">
	<meta name="keywords" content="HSP3,HotSoupProcessor3,HSP3Dish,android,ndk,google">
	<meta name="description" content="Information about HSP3Dish HGIMG4">
	<link href="../main.css" rel="stylesheet" type="text/css" media="all">
	<title>HGIMG4 Unity Integration Guide</title>
</head>
<body>
	<div id="CONTAINER">
	<!-- Header -->
	<p id="COPY">HSP : Hot Soup Processor ver3.6 / onion software 1997-2021(c)</p>
	<img src="hsp3dish.jpg" width="640" height="200" alt="title">
	<h1>HGIMG4 Unity Integration Guide</h1>

	<!-- Table of Contents -->
	<ol>
		<li><a href="#ABOUT">Introduction</a></li>
		<li><a href="#DEMO">List of Progra-mmering-chan Sample Demos</a></li>
		<li><a href="#FBXEXPORTER">FBX Exporter Export Process from Unity</a></li>
		<li><a href="#ANIMATION">Applying Animation in Unity</a></li>
		<li><a href="#LICENCE">Copyright and License</a></li>
	</ol>

		<h2 id="ABOUT">Introduction</h2>
		<p><font size="-1">
		By integrating HGIMG4 with Unity, you can apply more advanced motions and convert 3D models.
		You can check a sample of 3D character animation using HGIMG4 with the "Progra-mmering-chan Demo" (sample/pronama3d) included as a sample.<br>
		This is a sample demo using the <a href="https://kei.pronama.jp/" target="_blank">"Progra-mmering-chan"</a> material, a character from Programming Broadcasting.
		</p>
		<p>
		<img src="image/hgimg4_sample.jpg">
		</p>

		<h2 id="DEMO">List of Progra-mmering-chan Sample Demos</h2>

		<li>pronama3.hsp</li>
		<p>
		This is a sample that performs specular reflection rendering using multipass. The background uses a cube map skybox.
		</p>

		<p>
		<a href="image/pn2.png" target="_blank"><img src="image/pn2.png" width="512"></a>
		</p>

		<li>pronama4.hsp</li>
		<p>
		Progra-mmering-chan increases each time you press the click or space key. This is a sample that displays a large number of character animations.
		</p>

		<p>
		<a href="image/pn3.png" target="_blank"><img src="image/pn3.png" width="512"></a>
		</p>

		<li>pronama5.hsp</li>
		<p>
		You can switch between various effects, such as a cathode-ray tube TV-style display with post-processing.
		</p>

		<p>
		<a href="image/pn1.png" target="_blank"><img src="image/pn1.png" width="512"></a>
		</p>

		<li>pronama_box.hsp</li>
		<p>
		This is a sample that uses a physics engine to drop boxes. Boxes are generated each time you press the click or space key.
		</p>

		<p>
		<a href="image/pn5.png" target="_blank"><img src="image/pn5.png" width="512"></a>
		</p>

		<h2 id="UNITYHSP">Integration with Unity</h2>
		<p>
		By using Unity, which is widely used as a 3D game engine and tool, as a hub, it has become easier to use various models.<br>
		By exporting 3D models and animation data loaded into Unity as FBX files that can be used from HGIMG4 using Unity FBX Exporter, you can utilize assets, model data such as VRM, and animations in Unity.
		</p>
		<p>
		<img src="image/hgimg4_unity.jpg">
		</p>
		<p>
		Also, a GUI tool "HSP3d" is under development to manage material, model, and animation data.<br>
		By comprehensively managing and setting a wide variety of 3D data, complex data can be used from HSP3 in a simple form.<br>
		</p>


		<h2 id="FBXEXPORTER">FBX Exporter Export Process from Unity</h2>
		<p>
		Create a new project in Unity (Unity 2017.3 or later) and prepare (copy) the materials to be used under the Asset folder.
		When you select the FBX file included in the material, a model preview will be displayed in the Inspector.
		Here, we will use the normal version of Progra-mmering-chan. If you want to output animation, you need to set the avatar's animation type to Generic.
		If the animation type is Humanoid, it is a good idea to duplicate the FBX and then set the Generic model.<br>
		Once the settings are complete, place the model on the scene. Drag and drop the FBX into the Hierarchy window to place the model in the scene.
		</p>
		<p>
		<a href="image/p3.png" target="_blank"><img src="image/p3.png" width="512"></a>
		</p>
		<p>
		
		</p>
		<p>
		Download <a href="https://assetstore.unity.com/packages/essentials/fbx-exporter-101408" target="_blank">FBX Exporter</a> from the Asset Store and import it into the current project. FBX Exporter is a free asset officially distributed by Unity.
		</p>
		<p>
		<a href="image/p4.png" target="_blank"><img src="image/p4.png" width="512"></a>
		</p>
		<p>
		* This article is based on Unity FBX Exporter ver.1.3.0f1. FBX Exporter works with Unity 2017.3 and later, but does not guarantee operation in all versions.
		</p>
		<p>
		By importing the asset, you will be able to select "Export to FBX..." from the right-click menu of the model placed on the scene.
		</p>

		<p>
		<a href="image/p5.jpg" target="_blank"><img src="image/p5.jpg" width="512"></a>
		</p>
		<p>
		Basically, you can open the FBX Exporter window from here and output the FBX file.<br>
		In the FBX Exporter window options, set "Export Format" to Binary.
		After that, by pressing the "Export" button, the FBX file will be output to the specified folder.
		</p>

		<p>
		In order to use the output FBX file from HSP3 (HGIMG4), you need to convert the model data to a .gpb file.
		To convert to a .gpb file, use the included GPB converter (gpbconv.exe). By selecting the FBX file from the tool and pressing the "Convert" button, a .gpb file with the same name as the FBX file and a .material file will be generated.
		</p>
		<p>
		<img src="image/gpbconvert.png">
		</p>

		<p>
		Since the .gpb file contains only model data, if you are using texture (image) files, you need to prepare them separately. (HGIMG4 recommends using .png format for texture images used by the model.)<br>
		Copy all the .gpb file, .material file, and texture image (.png) files output from the GPB converter to the res folder below the script to be executed.
		</p>

		<p>
		If you want to output a model including animation, set the animation controller to the model on the scene and make sure that the animation is playing when Unity is running.<br>
		The FBX Exporter may issue an error when outputting a model with a bone structure.
		In many cases, this is because the RootBone of the model's skin mesh (Skinned Mesh Renderer) setting is not set correctly.
		By setting RootBone to a layer close to the root of the bone structure, you should be able to output it correctly.
		</p>
		<p>
		* In the current version, due to the constraints of HGIMG4's model conversion, if there is rotation or scaling in the layer where the model's skin mesh (Skinned Mesh Renderer) is located, it may not be displayed correctly on HGIMG4. When outputting some model data, such as the Progra-mmering-chan model, be sure to set the rotation of the mesh layer to 0 and the scale to 1. There are no particular restrictions on rotation or scaling in other layers.
		</p>
		<p>
		* When outputting the Progra-mmering-chan model, some parts such as spats and socks may flicker.<br>
		This is because the replacement materials are displayed overlapping, and to display them correctly, you need to set the FBX material import as follows.
		You can set the material settings when importing the model in the inspector of the PronamaChan.fbx file.
		</p>

		<p>
		<a href="image/pn_material.png" target="_blank"><img src="image/pn_material.png" width="720"></a>
		</p>

		<p>
		Assign the material file (.mat) under the Materials/Unlit folder to each material.
		For example, assign the "skin" material to "BODY_skin".
		"BODY_skin.002", "BODY_skin.003", and "BODY_skin.004" are materials for replacement and do not need to be displayed in the first place, so specify the "transparent" material.<br>
		Transparent materials are not displayed on Unity, but transparent materials are displayed as white when displayed on HGIMG4.
		Therefore, we will edit the .material file that performs the HGIMG4 display material settings.
		When you convert the PronamaChan.fbx file with the GPB converter, the material settings are saved as PronamaChan.material. Open this file with a text editor and edit the "material transparent_187 : colored" item.
		</p>

		<pre>
		material transparent_187 : colored
		{
		    u_diffuseColor = 1, 1, 1, 1
		    u_inverseTransposeWorldViewMatrix = INVERSE_TRANSPOSE_WORLD_VIEW_MATRIX
		    u_matrixPalette = MATRIX_PALETTE
		    
		    renderState
		    {
			depthFunc = NEVER
		    }
		
		    technique
		    {
		        pass 
		        {
		            defines = SKINNING;SKINNING_JOINT_COUNT 187
		        }
		    }
		}
		</pre>

		<p>
		By setting the renderState item, we are specifying not to draw the transparent_187 material.
		This should display it correctly. If you don't use (don't display) spats or socks, you also need to specify the materials for spats and socks as transparent.
		</p>

		<h2 id="ANIMATION">Applying Animation in Unity</h2>

		<p>
		<a href="image/p7.png" target="_blank"><img src="image/p7.png" width="512"></a>
		</p>

		<p>
		There are several ways to apply animation to a model, but as a site where you can easily obtain animation data, there is <a href="https://www.mixamo.com/" target="_blank">mixamo</a>.
		<a href="https://www.mixamo.com/" target="_blank">mixamo</a> allows you to download animations applied to various models as FBX files for free, and has a highly flexible license.
		</p>
		<p>
		<img src="image/mixamo.jpg">
		</p>
		<p>
		Unity's asset store also offers a wide variety of motion data and tools for creating it, allowing you to do a significant portion of your work for free.<br>
		Including Mixamo, many animation data sets are designed for Humanoid rig animation types.
		To output animation with FBX Exporter, you need to use a Generic rig, and standard Unity features do not allow converting between Humanoid and Generic.<br>
		However, some paid assets support this conversion, and <a href="https://assetstore.unity.com/packages/tools/animation/umotion-pro-animation-editor-95991" target="_blank">UMotion Pro</a> can be used as one such solution.
		</p>

		<p>
		<a href="image/p8.png" target="_blank"><img src="image/p8.png" width="512"></a>
		</p>

		<p>
		In the sample Pronama-chan demo, UMotion Pro is used to convert Mixamo animation data.
		<a href="https://assetstore.unity.com/packages/tools/animation/umotion-pro-animation-editor-95991" target="_blank">UMotion Pro</a> can also be used to create animation data itself, so its potential applications are vast.
		</p>
		<p>
		It is also possible to load the 3D avatar file format <a href="https://dwango.github.io/vrm/" target="_blank">VRM</a> into Unity using <a href="https://github.com/dwango/UniVRM" target="_blank">UniVRM</a> and output it with FBX Exporter.
		</p>

		<p>
		<img src="image/hgimg4_vrm.jpg">
		</p>

		<p>
		By using Unity as a hub, you can leverage a wide range of 3D models and animations.
		By controlling 3D from HSP3 scripts, you can expand your applications with your own ideas for creating simple games, testing applications, and more.
		</p>


		<h2 id="LICENCE">Copyright and License</h2>
		<p>
		The runtime and script files included in the archive can be attached, copied, modified, and redistributed under the same license as the HSP main unit.<br>
		The rights to data and generated scripts created by users using the tools belong to the user who created them.<br>		Please refer to the following for the license of the 3D model (Pronama-chan) used in the sample.
		<pre>
		Kurei Kei (Pronama-chan) 3D model
		ÊÅØ Pronama LLC
		*For details, see <a href="https://kei.pronama.jp/" target="_blank">https://kei.pronama.jp/</a>
		</pre>
		When using the materials, be sure to read the "Pronama-chan" usage guidelines.
		</p>
		<pre>
		Pronama-chan (Kurei Kei) Usage Guidelines
		<a href="https://kei.pronama.jp/guideline/" target="_blank">https://kei.pronama.jp/guideline/</a>
		</pre>


	<!-- Footer -->
	<ul id="FOOTER">
		<li><a href="#CONTAINER">Back to the top of this page</a></li>
		<li><a href="../index.htm">Back to index</a></li>
	</ul>
	<a href="https://www.onionsoft.net/">
		<img src="onibtn.gif" width="147" height="50" alt="ONION software" id="ONIBTN">
	</a>
</div><!-- container -->
</body>
</html>
